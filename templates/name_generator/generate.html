{% extends "base.html" %}

{% block title %}Business Name Generator · thespacedata{% endblock %}

{% block content %}
<h1 class="text-4xl font-semibold mb-8">Business Name Generator</h1>

<form id="name-form" method="post" enctype="multipart/form-data" class="space-y-6">
  {% csrf_token %}

  <!-- Prompt -->
  <div>
    <label for="id_prompt" class="block text-sm font-medium mb-1">Describe what you want</label>
    {{ form.prompt }}
    {% if form.prompt.errors %}
      <p class="mt-1 text-sm text-red-600">{{ form.prompt.errors|join:", " }}</p>
    {% endif %}
    <p class="mt-1 text-xs text-slate-500">
      Tip: you can add hints like <code>industry: fintech</code> or <code>style: playful, premium</code>.
    </p>
  </div>

  <!-- Advanced options -->
  <details class="rounded-lg border border-slate-200">
    <summary class="px-4 py-3 cursor-pointer select-none font-medium">Advanced options</summary>
    <div class="p-4 space-y-4">
      <div>
        <label for="id_industry" class="block text-sm font-medium mb-1">Industry</label>
        {{ form.industry }}
      </div>
      <div>
        <label for="id_style" class="block text-sm font-medium mb-1">Style keywords</label>
        {{ form.style }}
      </div>
      <div>
        <label for="id_count" class="block text-sm font-medium mb-1">How many?</label>
        {{ form.count }}
      </div>
    </div>
  </details>

  <!-- Submit -->
  <div class="flex items-center gap-4">
    <button id="generate-btn" type="submit"
      class="inline-flex items-center gap-2 px-5 py-2.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed">
      <svg id="btn-spinner" class="hidden h-4 w-4 animate-spin" viewBox="0 0 24 24" aria-hidden="true">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4z"></path>
      </svg>
      <span id="btn-text">Generate</span>
    </button>
    <p class="text-sm text-slate-500">Press <b>Enter</b> to submit · <b>Shift+Enter</b> for newline</p>
  </div>
</form>

<!-- Suggestions -->
<section class="mt-10">
  <h2 class="text-2xl font-semibold mb-4">Suggestions</h2>
  {% if names %}
    <ol class="list-decimal pl-6 space-y-3">
      {% for n in names %}
        <li class="rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3 flex items-center justify-between gap-3">
          <span class="font-medium">{{ n }}</span>
          {% if used_openai is not None %}
            <span class="rounded-full border px-2.5 py-0.5 text-xs
              {% if used_openai %}border-indigo-300 text-indigo-700 bg-indigo-50
              {% else %}border-slate-300 text-slate-700 bg-slate-50{% endif %}">
              {{ used_openai|yesno:"OpenAI,Local" }}
            </span>
          {% endif %}
        </li>
      {% endfor %}
    </ol>
  {% else %}
    <p class="text-slate-500">No suggestions yet.</p>
  {% endif %}
</section>

<!-- Recent history -->
<section class="mt-10">
  <h2 class="text-2xl font-semibold mb-4">Recent history</h2>
  {% if recent %}
    <ul class="space-y-2">
      {% for item in recent %}
        <li>
          <a href="{% url 'name_generator:generate' %}?id={{ item.id }}"
             class="block rounded-lg border border-zinc-200 px-4 py-3 hover:bg-zinc-50">
            <div class="flex items-center justify-between">
              <div class="truncate font-medium">{{ item.prompt|default:item.keywords|truncatechars:80 }}</div>
              <span class="text-xs text-slate-500">{{ item.created_at|date:"M d, H:i" }}</span>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-slate-500">No runs yet.</p>
  {% endif %}
</section>
{% endblock %}

{% block body_scripts %}
<script>
  (function () {
    const form   = document.getElementById('name-form');
    const ta     = document.getElementById('id_prompt');
    const btn    = document.getElementById('generate-btn');
    const spin   = document.getElementById('btn-spinner');
    const btnTxt = document.getElementById('btn-text');

    if (ta && form) {
      ta.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          form.requestSubmit ? form.requestSubmit() : form.submit();
        }
      });
    }

    if (form && btn && spin && btnTxt) {
      form.addEventListener('submit', function () {
        spin.classList.remove('hidden');
        btnTxt.textContent = 'Generating...';
        btn.setAttribute('aria-busy', 'true');
        btn.disabled = true;
        Array.from(form.elements).forEach(el => {
          if (el instanceof HTMLElement) el.setAttribute('disabled', 'disabled');
        });
      }, { once: true });
    }
  })();
</script>
{% endblock %}