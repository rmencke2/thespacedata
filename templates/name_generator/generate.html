{% extends "base.html" %}

{% block title %}Business Name Generator · thespacedata{% endblock %}

{% block content %}
<h1 class="text-4xl font-semibold mb-8">Business Name Generator</h1>

<form id="name-form" method="post" class="space-y-6">
  {% csrf_token %}

  <!-- Single prompt (default) -->
  <div>
    <label class="block text-sm font-medium mb-1" for="id_prompt">
      Describe what you want
    </label>

    {{ form.prompt }}  {# <-- THIS actually renders the textarea #}

    {% if form.prompt.errors %}
      {% for e in form.prompt.errors %}
        <p class="mt-1 text-sm text-red-600">{{ e }}</p>
      {% endfor %}
    {% endif %}

    <p class="mt-1 text-xs text-slate-500">
      Tip: you can add hints like <code>industry: fintech</code> or
      <code>style: playful, premium</code>.
    </p>
  </div>

  <!-- Advanced options (collapsible) -->
  <details class="rounded-lg border border-slate-200">
    <summary class="px-4 py-3 cursor-pointer select-none font-medium">
      Advanced options
    </summary>
    <div class="p-4 space-y-4">
      <div>
        <label class="block text-sm font-medium mb-1" for="id_industry">Industry</label>
        {{ form.industry }}
      </div>
      <div>
        <label class="block text-sm font-medium mb-1" for="id_style">Style keywords</label>
        {{ form.style }}
      </div>
      <div>
        <label class="block text-sm font-medium mb-1" for="id_count">How many?</label>
        {{ form.count }}
      </div>
    </div>
  </details>

  <div class="flex items-center gap-4">
    <button type="submit"
            class="inline-flex items-center px-5 py-2.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">
      Generate
    </button>
    <p class="text-sm text-slate-500">Press <b>Enter</b> to submit · <b>Shift+Enter</b> for newline</p>
  </div>
</form>

<!-- Suggestions -->
<section class="mt-10">
  <h2 class="text-2xl font-semibold mb-4">Suggestions</h2>
  {% if names and names|length %}
    <ol class="list-decimal pl-6 space-y-3">
      {% for n in names %}
        <li class="rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3">
          <div class="flex items-center justify-between gap-3">
            <span class="font-medium">{{ n }}</span>
            {% if used_openai is not None %}
              <span class="rounded-full border px-2.5 py-0.5 text-xs
                           {% if used_openai %}border-indigo-300 text-indigo-700 bg-indigo-50
                           {% else %}border-slate-300 text-slate-700 bg-slate-50{% endif %}">
                {% if used_openai %}OpenAI{% else %}Local{% endif %}
              </span>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ol>
  {% else %}
    <ol class="list-decimal pl-6">
      <li class="text-slate-500">No suggestions yet.</li>
    </ol>
  {% endif %}
</section>

<!-- Recent history -->
<section class="mt-10">
  <h2 class="text-2xl font-semibold mb-4">Recent history</h2>
  {% if recent %}
    <ul class="space-y-2">
      {% for item in recent %}
        <li>
          <a class="block rounded-lg border border-zinc-200 px-4 py-3 hover:bg-zinc-50"
             href="{% url 'name_generator:generate' %}?id={{ item.id }}">
            <div class="flex items-center justify-between">
              <div class="truncate">
                <span class="font-medium">{{ item.prompt|default:item.keywords|truncatechars:80 }}</span>
              </div>
              <span class="text-xs text-slate-500">{{ item.created_at|date:"M d, H:i" }}</span>
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-slate-500">No runs yet.</p>
  {% endif %}
</section>

{% endblock %}

{% block body_scripts %}
<script>
  // Press Enter to submit; Shift+Enter for newline
  (function () {
    const form = document.getElementById('name-form');
    const ta   = document.getElementById('id_prompt');
    if (form && ta) {
      ta.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          form.requestSubmit ? form.requestSubmit() : form.submit();
        }
      });
    }
  }());
</script>
{% endblock %}